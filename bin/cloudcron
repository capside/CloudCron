#!/usr/bin/env perl
use strict;
use warnings;
use v5.10;

use Cfn;
use CloudCron::Compiler;
use CloudCron::TargetQueue;
use JSON;

my $file = $ARGV[0] or die "$0 must specify a file";
my $target = CloudCron::TargetQueue->new({
    Arn => 'Arn',
    Id  => 'Id',
});

my $cfn = Cfn->new;
my $compiler = CloudCron::Compiler->new({ file => $file, target => $target });
for my $linerule ($compiler->rules) {
    my $name = "cron-line-" . $linerule->line;
    $cfn->addResource($name, $linerule->rule);
}
my $hr = $cfn->as_hashref;

print encode_json($hr);
